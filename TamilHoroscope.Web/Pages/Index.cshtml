@page
@model IndexModel
@{
    ViewData["Title"] = "Home";
}

<div class="container-fluid mt-4">
    @if (User.Identity?.IsAuthenticated ?? false)
    {
        <!-- Authenticated User Dashboard -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="mb-3"><i class="bi bi-stars text-primary"></i> Welcome, @Model.UserFullName!</h1>
                <p class="text-muted">Dashboard · @(DateTime.UtcNow.ToString("MMMM dd, yyyy"))</p>
            </div>
        </div>

        <!-- Status Cards Row -->
        <div class="row mb-4">
            <!-- Trial Status Card -->
            @if (Model.IsTrialActive)
            {
                <div class="col-md-3">
                    <div class="card border-success h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="card-title text-success"><i class="bi bi-gift"></i> Trial Active</h6>
                                    <p class="display-6 text-success mb-0">@Model.DaysRemainingInTrial</p>
                                    <small class="text-muted">Days Remaining</small>
                                </div>
                                <span class="badge bg-success">Active</span>
                            </div>
                            <hr>
                            <small>Trial ends on <strong>@Model.TrialEndDate?.ToString("MMM dd, yyyy")</strong></small>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="col-md-3">
                    <div class="card border-warning h-100">
                        <div class="card-body">
                            <h6 class="card-title text-warning"><i class="bi bi-exclamation-circle"></i> Trial Expired</h6>
                            <p class="text-muted mb-2">Your trial period has ended</p>
                            <a asp-page="/Wallet/TopUp" class="btn btn-sm btn-outline-warning">Upgrade Now</a>
                        </div>
                    </div>
                </div>
            }

            <!-- Wallet Balance Card -->
            <div class="col-md-3">
                <div class="card border-primary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-title text-primary"><i class="bi bi-wallet2"></i> Wallet Balance</h6>
                                <p class="display-6 text-primary mb-0">₹@Model.WalletBalance.ToString("0.00")</p>
                            </div>
                            @if (Model.WalletBalance < 50)
                            {
                                <span class="badge bg-warning text-dark">Low</span>
                            }
                            else
                            {
                                <span class="badge bg-success">Good</span>
                            }
                        </div>
                        <hr>
                        <a asp-page="/Wallet/TopUp" class="btn btn-sm btn-outline-primary">Add Funds</a>
                    </div>
                </div>
            </div>

            <!-- Subscription Status Card -->
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body">
                        @if (Model.HasActiveSubscription)
                        {
                            <div>
                                <h6 class="card-title text-success"><i class="bi bi-check-circle"></i> Premium Active</h6>
                                <p class="text-success mb-2">Full features unlocked</p>
                                @if (!Model.IsTrialActive && Model.SubscriptionEndDate != null)
                                {
                                    <small class="text-muted">Valid for <strong>@Model.WalletDaysRemaining days</strong></small>
                                }
                                else if (Model.IsTrialActive)
                                {
                                    <small class="text-muted">Trial until <strong>@Model.TrialEndDate?.ToString("MMM dd")</strong></small>
                                }
                            </div>
                        }
                        else
                        {
                            <div>
                                <h6 class="card-title"><i class="bi bi-star"></i> No Premium</h6>
                                <p class="text-muted mb-2">Upgrade to unlock all features</p>
                                <a asp-page="/Wallet/TopUp" class="btn btn-sm btn-outline-primary">Go Premium</a>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Wallet Days Remaining Card -->
            <div class="col-md-3">
                <div class="card border-info h-100">
                    <div class="card-body">
                        <h6 class="card-title text-info"><i class="bi bi-calendar-check"></i> Days Remaining</h6>
                        @if (Model.IsTrialActive)
                        {
                            <p class="display-6 text-info mb-0">@Model.DaysRemainingInTrial</p>
                            <small class="text-muted">Trial Days Left</small>
                        }
                        else if (Model.WalletDaysRemaining > 0)
                        {
                            <p class="display-6 text-info mb-0">@Model.WalletDaysRemaining</p>
                            <small class="text-muted">Wallet Days Left</small>
                        }
                        else
                        {
                            <p class="text-warning mb-2">No balance</p>
                            <a asp-page="/Wallet/TopUp" class="btn btn-sm btn-outline-warning">Add Funds</a>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Row -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="bi bi-lightning-fill text-warning"></i> Quick Actions</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2 d-sm-flex">
                            <a asp-page="/Horoscope/Generate" class="btn btn-lg btn-primary flex-grow-1">
                                <i class="bi bi-stars"></i> Generate Horoscope
                            </a>
                            <a asp-page="/Horoscope/History" class="btn btn-lg btn-outline-primary flex-grow-1">
                                <i class="bi bi-clock-history"></i> View History
                            </a>
                            <a asp-page="/Wallet/TopUp" class="btn btn-lg btn-outline-success flex-grow-1">
                                <i class="bi bi-cash-coin"></i> Top Up Wallet
                            </a>
                            <a asp-page="/Account/Profile" class="btn btn-lg btn-outline-secondary flex-grow-1">
                                <i class="bi bi-person-circle"></i> My Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Information Grid -->
        <div class="row">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Your Account Status</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm mb-0">
                            <tr>
                                <td><strong>Account Name</strong></td>
                                <td>@Model.UserFullName</td>
                            </tr>
                            <tr>
                                <td><strong>Email</strong></td>
                                <td>@(string.IsNullOrEmpty(Model.UserEmail) ? "Not provided" : Model.UserEmail)</td>
                            </tr>
                            <tr>
                                <td><strong>Current Balance</strong></td>
                                <td><span class="badge bg-primary">₹@Model.WalletBalance.ToString("0.00")</span></td>
                            </tr>
                            <tr>
                                <td><strong>Account Status</strong></td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-gift"></i> Available Features</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success"></i>
                                <strong>Birth Chart Analysis</strong>
                                <span class="badge bg-light text-dark float-end">@(Model.IsTrialActive || Model.HasActiveSubscription ? "Available" : "Trial Only")</span>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success"></i>
                                <strong>Dasa & Bhukti Periods</strong>
                                <span class="badge bg-light text-dark float-end">@(Model.HasActiveSubscription ? "Premium" : "Basic")</span>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success"></i>
                                <strong>Planetary Strength Analysis</strong>
                                <span class="badge bg-light text-dark float-end">@(Model.HasActiveSubscription ? "Available" : "Locked")</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle text-success"></i>
                                <strong>Navamsa Chart (D-9)</strong>
                                <span class="badge bg-light text-dark float-end">@(Model.HasActiveSubscription ? "Available" : "Locked")</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Unauthenticated User Landing Page -->
        <div class="jumbotron bg-light p-5 rounded">
            <div class="container text-center">
                <h1 class="display-4"><i class="bi bi-stars text-primary"></i> Tamil Horoscope</h1>
                <p class="lead">Get accurate Vedic astrology horoscopes in Tamil and English</p>
                <hr class="my-4">
                <p>Generate personalized horoscopes with birth chart, planetary positions, Dasa periods, and more!</p>
                <a class="btn btn-primary btn-lg" asp-page="/Account/Register" role="button">
                    <i class="bi bi-person-plus"></i> Register Now - Free 30-Day Trial!
                </a>
                <a class="btn btn-outline-primary btn-lg" asp-page="/Account/Login" role="button">
                    <i class="bi bi-box-arrow-in-right"></i> Login
                </a>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md-4">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <i class="bi bi-calendar3 display-4 text-primary"></i>
                        <h5 class="card-title mt-3">Birth Chart Analysis</h5>
                        <p class="card-text">Complete Rasi chart with planetary positions, houses, and aspects</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <i class="bi bi-clock-history display-4 text-primary"></i>
                        <h5 class="card-title mt-3">Vimshottari Dasa</h5>
                        <p class="card-text">Detailed planetary periods (Dasa & Bhukti) for life events prediction</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center h-100">
                    <div class="card-body">
                        <i class="bi bi-graph-up display-4 text-primary"></i>
                        <h5 class="card-title mt-3">Planetary Strength</h5>
                        <p class="card-text">Shadbala calculations showing planet strength and influences</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-gift"></i> Trial Period Features</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success"></i> Birth details display</li>
                            <li><i class="bi bi-check-circle text-success"></i> Rasi (birth) chart</li>
                            <li><i class="bi bi-check-circle text-success"></i> Basic Dasa periods</li>
                            <li><i class="bi bi-check-circle text-success"></i> 30 days free access</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-star-fill"></i> Paid Subscription Features</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-primary"></i> All trial features</li>
                            <li><i class="bi bi-check-circle text-primary"></i> Navamsa (D-9) chart</li>
                            <li><i class="bi bi-check-circle text-primary"></i> Complete Dasa with Bhukti sub-periods</li>
                            <li><i class="bi bi-check-circle text-primary"></i> Planetary strength analysis</li>
                            <li><i class="bi bi-check-circle text-primary"></i> Only ₹5 per day</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="alert alert-info mt-5">
            <h5><i class="bi bi-info-circle"></i> How It Works</h5>
            <ol class="mb-0">
                <li><strong>Register:</strong> Create your free account (email or mobile number)</li>
                <li><strong>Try Free:</strong> Get 30 days trial with basic features</li>
                <li><strong>Top Up Wallet:</strong> Add funds to your wallet (minimum ₹100)</li>
                <li><strong>Generate:</strong> Create horoscopes - charged only once per day</li>
            </ol>
        </div>
    }
</div>
